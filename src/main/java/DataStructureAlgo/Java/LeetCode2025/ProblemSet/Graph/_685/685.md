# 685. Redundant Connection II — Deep Understanding Notes

---

# 1️⃣ What is a valid rooted tree in a directed graph?

A valid rooted tree must satisfy:

1. Exactly one node has indegree = 0 (the root).
2. Every other node has indegree = 1.
3. Total edges = n - 1.
4. No cycles.

If we ignore direction, it forms a normal undirected tree.

---

# 2️⃣ What changes after adding one extra edge?

Originally it was a valid tree.
One extra directed edge is added.

Now:

* Total edges = n
* One of the tree properties must be violated.

This creates exactly three structural possibilities.

---

# 3️⃣ The Three Possible Cases

## Case A: Indegree = 2, No Cycle

Example:

[1,3], [2,3], [1,2]

* Node 3 has indegree 2.
* No cycle exists.

Fix:
Remove the later edge pointing to that node.

---

## Case B: Cycle Only (No Node Has Indegree 2)

Example:

[1,2], [2,3], [3,4], [4,1]

* All nodes have indegree 1.
* A directed cycle exists.

Fix:
Remove the edge that forms the cycle (the later one in input).

---

## Case C: Both Indegree = 2 AND Cycle

Example:

[1,3], [3,2], [2,3]

* Node 3 has indegree 2.
* There is a cycle: 1 → 3 → 2 → 3

Now we have two suspicious edges:

candidate1 = earlier edge to the node
candidate2 = later edge to the node

We must determine which one to remove.

---

# 4️⃣ Why Union-Find Works (Even Though Graph Is Directed)

Union-Find detects whether two nodes are already connected.

Key insight:
The original structure was a tree.

In a tree:

* There is exactly one undirected path between any two nodes.
* Adding an edge between already connected nodes must create a cycle.

So even though edges are directed,
we can ignore direction for cycle detection.

Union-Find is checking connectivity, not direction.

---

# 5️⃣ The Key Trick for Case C

We detect a node with two parents:

candidate1: u1 → v  (earlier)
candidate2: u2 → v  (later)

Strategy:

1. Temporarily skip candidate2.
2. Run Union-Find on remaining edges.

Now two possibilities:

### If cycle STILL forms:

Even without candidate2, a cycle exists.

Therefore candidate1 must be part of the cycle.

Answer = candidate1

---

### If NO cycle forms:

Removing candidate2 restores tree property.

Answer = candidate2

---

# 6️⃣ Final Algorithm Structure

Step 1: Detect if any node has indegree = 2.

Step 2: If yes,
- record candidate1 and candidate2.
- skip candidate2 during Union-Find.

Step 3: Run Union-Find over edges.

```
- If cycle detected:
      - If no candidate1 → Case B → return current edge
      - Else → Case C → return candidate1
```

Step 4: If no cycle detected:
→ Case A → return candidate2

Time Complexity: O(n)

---

# 7️⃣ Mental Model Summary

We are not solving a directed cycle problem.
We are restoring the tree property.

Tree property is fundamentally an undirected invariant:

* Connected
* No cycle
* Exactly n-1 edges

We simply identify which edge violates it.

---

# 8️⃣ Structural Insight Gained

• Understand tree invariants deeply.
• Distinguish structural cases cleanly.
• Defer decision when ambiguity exists.
• Use Union-Find for connectivity reasoning.
• Convert directed-tree problem into undirected connectivity check.

---

This is a complete conceptual understanding of the problem.
